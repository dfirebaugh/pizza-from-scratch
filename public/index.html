<!DOCTYPE html>

<html>

<head>
	<title>Pizza From Scratch</title>

	<link href="/public/css/main.css" rel="stylesheet" type="text/css">
	<script type="text/javascript" src="common/ajax-functions.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.4.2/react.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.4.2/react-dom.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/6.21.1/babel.min.js"></script>
	
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
	<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
</head>

<body>
	<!-- Looking at this file, months after Dustin and I were last working on it, I regret 
		not writing an overall descriptive comment, at least.  This is supposed to be the 
		entry point HTML file, and still is, I'm sure.

	-->>
	<div id='root'></div>
	<link href="cp_reset.css" rel="stylesheet" type="text/css" />
	<!-- <script src="toonNavButton.js"></script> -->
	<script type="text/babel">
		 const hostVar= '10.200.200.182'
			const Header = () => (
				<header>
					<p>Welcome, <span id="display-name"></span>!</p>
					<a class="menu" href="/profile">Profile</a>
					<p>|</p>
					<a class="menu" href="/logout">Logout</a>
				</header>
			)
			class Latest extends React.Component {
				componentDidMount(){
					fetch(`http://${hostVar}:8080/api/toons/`)
						.then(response => response.json())
						.then(json => {
							this.setState({toons:json, curIndex: json.length - 1})
						})
				}
				clickHandler = (d) =>{
					if(d.target.id === 'first'){
						this.setState({curIndex:0})
					}
					else if(d.target.id === 'prev'){
						if(this.state.curIndex > 0){
							this.setState({curIndex:this.state.curIndex -= 1})
						}
						else{
							alert("That's as previous as it gets!")	
						}
					}
					else if(d.target.id === 'next'){
						if(this.state.curIndex < this.state.toons.length - 1){
							this.setState({curIndex:this.state.curIndex += 1})
						}
						else{
							alert("That's as next as it gets!")
						}
					}
					else if(d.target.id === 'latest'){
						this.setState({curIndex:this.state.toons.length - 1})
					}
				}
				render() {
					const Btns = () => (
								<div className='container btns'>
									<button id='first' onClick={this.clickHandler}>First</button>
									<button id='prev' onClick={this.clickHandler}> Prev </button>
									<button id='next' onClick={this.clickHandler}> Next </button>
									<button id='latest' onClick={this.clickHandler}>Latest</button>
								</div>
							)
					return (
						<div className='toon-container flex-container'>
							{/*conditionally render header*/}
							{false && <Header />}
							<div id='toons'>
								<Btns />
								<ToonBox toon={this.state && this.state.toons[this.state.curIndex]} />
								<Btns />
							</div>
						</div>
					);
				}
			}

			const ToonBox = props => {
				const checkRow = (p,currentRow) => {
					return p.toon.panels.filter(x => Number(x.pos.substr(1,1)) === currentRow)
				}
				const cartoonPanels = x => {
					let panelObj = {}
					let curRow = 1;
					let screenW=window.innerWidth;
					return x.map( panel => {
						return <div className='panel col-md-2'>
									<img className={panel.id.substr(0,2),"panel col-12 col-sm-12"} src={panel.url}></img>
								</div>
						})
						}
				if (props.toon){
					console.log(props.toon)
					return  (
						<div className='container toon-box'>
							<h2> {  props.toon.title } </h2>
							<h3>{  props.toon.publishingDate }</h3>
							
							<div className="row first-row  ">{  cartoonPanels(checkRow(props,1)) }</div>
							<div className="row second-row ">{  cartoonPanels(checkRow(props,2)) }</div>
							<div className="row third-row ">{  cartoonPanels(checkRow(props,3)) }</div>
							<div className="row fourth-row ">{  cartoonPanels(checkRow(props,4)) }</div>
							
							<p>{  props.toon.artistComments }</p>
						</div>)
				}
				else {
					console.log('returning null!!!')
					return null
				}
			} // closes ToonBox


			ReactDOM.render(
				<Latest />,
				document.getElementById('root')
			);
		</script>
</body>

</html>