<!DOCTYPE html>

<html>

<head>
	<title>Pizza From Scratch</title>

	<link href="/public/css/main.css" rel="stylesheet" type="text/css">
</head>

<body>
	<div id='root'></div>
	<link href="cp_reset.css" rel="stylesheet" type="text/css" />
	<script type="text/javascript" src="common/ajax-functions.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.4.2/react.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.4.2/react-dom.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/6.21.1/babel.min.js"></script>

	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	<!-- <script src="toonNavButton.js"></script> -->
	<script type="text/babel">
		 const hostVar= '10.200.200.155'
			const Header = () => (
				<header>
					<p>Welcome, <span id="display-name"></span>!</p>
					<a class="menu" href="/profile">Profile</a>
					<p>|</p>
					<a class="menu" href="/logout">Logout</a>
				</header>
			)
			class Latest extends React.Component {
				componentDidMount(){
					fetch(`http://${hostVar}:8080/api/toons/`)
						.then(response => response.json())
						.then(json => {
							this.setState({toons:json, curIndex: json.length - 1})
						})
				}
				clickHandler = (d) =>{
					if(d.target.id === 'first'){
						this.setState({curIndex:0})
					}
					else if(d.target.id === 'prev'){
						if(this.state.curIndex > 0){
							this.setState({curIndex:this.state.curIndex -= 1})
						}
						else{
							alert("that's as previous as it gets!")	
						}
					}
					else if(d.target.id === 'next'){
						if(this.state.curIndex < this.state.toons.length - 1){
							this.setState({curIndex:this.state.curIndex += 1})
						}
						else{
							alert("That's as next as it gets!")
						}
					}
					else if(d.target.id === 'latest'){
						this.setState({curIndex:this.state.toons.length - 1})
					}
				}
				render() {
					const Btns = () => (
								<div className='btns'>
									<button id='first' onClick={this.clickHandler}>First</button>
									<button id='prev' onClick={this.clickHandler}> Prev </button>
									<button id='next' onClick={this.clickHandler}> Next </button>
									<button id='latest' onClick={this.clickHandler}>Latest</button>
								</div>
							)
					return (
						<div className='toon-container'>
							{/*conditionally render header*/}
							{false && <Header />}
							<div id='toons'>
								<Btns />
								<ToonBox toon={this.state && this.state.toons[this.state.curIndex]} />
								<Btns />
							</div>
						</div>
					);
				}
			}

			const ToonBox = props => {
				const cartoonPanels = x => {
					let panelObj = {}
					let curRow = 1;
					let panels = x.map( panel => {
						return <img className={panel.id.substr(0,2),"col-md-2,col-lg-2,col-sm-12"} src={panel.url}></img>
						// ,col-md-2,col-lg-2,col-sm-12
					}) 
					return panels
				} 
				const checkRow = (p,currentRow) => {
					return p.toon.panels.filter(x => Number(x.pos.substr(1,1)) === currentRow)
				}
					//  console.log ('position: ', props.toon.panels.filter(x => Number(x.pos.substr(1,1)) === 1))
				if (props.toon){
					console.log(props.toon)
					return  (
						<div>
							<h2> {  props.toon.title } </h2>
							<h3>{  props.toon.publishingDate }</h3>
							
							<div className="first-row col-md-12 col-lg-12">{  cartoonPanels(checkRow(props,1)) }</div>
							<div className="second-row col-md-12">{  cartoonPanels(checkRow(props,2)) }</div>
							<div className="third-row col-md-12">{  cartoonPanels(checkRow(props,3)) }</div>
							<div className="fourth-row col-md-12">{  cartoonPanels(checkRow(props,4)) }</div>
							
							<p>{  props.toon.artistComments }</p>
						</div>)
				}
				else {
					console.log('returning null!!!')
					return null
				}
			}


			ReactDOM.render(
				<Latest />,
				document.getElementById('root')
			);
		</script>
</body>

</html>